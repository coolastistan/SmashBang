<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Three.js Planetary system</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	</head>
	<body>

		<div id="container"></div>

		<!-- <script src="three.min.js"></script> -->
		<script src="three.js"></script>
		<script>
			// Lots of global variables. (This is JavaScript. No use complaining.)
			var container;
			var camera, scene, renderer;
			
			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;			
			
			// Object3D ("Group") nodes and Mesh nodes
			var sceneRoot = new THREE.Group();
			var objectSpin = new THREE.Group();
			var moveEarth = new THREE.Group(); 
			var cameraRot = new THREE.Group();
			var earthOrb = new THREE.Group();
			
			var subSpin = new THREE.Group();
			
			var moonOrb = new THREE.Group();
			var moonTrabs = new THREE.Group();
		    var moonSpin = new THREE.Group();
			
			
			var earthMesh;
			var sunMesh;
			var moonMesh;

			
			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			
			function init() {

				container = document.getElementById( 'container' );

				camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 0.1, 100 );
				camera.position.z = 10;

				scene = new THREE.Scene();
								
				// Mesh earth
				var earthSphere = new THREE.SphereGeometry( 1, 30, 30 );
				var materialEarth = new THREE.MeshPhongMaterial();
				var loaderEarth = new THREE.TextureLoader();
				loaderEarth.load( 'earth.png', function( texture ) 
				{
					
					materialEarth.map = texture;
					materialEarth.needsUpdate = true;
					materialEarth.overdraw = 1;					
				} );
			
				earthMesh = new THREE.Mesh( earthSphere, materialEarth );
				
				
				// mesh sun 
				var sunSphere = new THREE.SphereGeometry( 2, 30, 30 );
				var materialSun = new THREE.MeshBasicMaterial();
				var loaderSun = new THREE.TextureLoader();
				loaderEarth.load( 'sun.png', function( texture ) 
				{
					
					materialSun.map = texture;
					materialSun.needsUpdate = true;
					materialSun.overdraw = 1;					
				} );
				sunMesh = new THREE.Mesh( sunSphere, materialSun );
				
				//Mesh moon 
				var moonSphere = new THREE.SphereGeometry( 0.2, 30, 30 );
				var materialMoon = new THREE.MeshPhongMaterial();
				var loaderMoon = new THREE.TextureLoader();
				loaderMoon.load( 'moon.png', function( texture ) 
				{
					
					materialMoon.map = texture;
					materialMoon.needsUpdate = true;
					materialMoon.overdraw = 1;					
				} );
				moonMesh = new THREE.Mesh( moonSphere, materialMoon );
				
				// Top-level node
				scene.add( sceneRoot );

				// Tree 
				sceneRoot.add( cameraRot ); //moveEarth Ã¤r barn till sceneRoot
				
				var light = new THREE.PointLight( 0xffffff, 1, 100 );
				light.position.set( 0, 0, 0 );
				scene.add( light );
				
				// Earth tree
				cameraRot.add( earthOrb );
				earthOrb.add(moveEarth);
				moveEarth.add( objectSpin );
				objectSpin.add( earthMesh );
				
				// Sun tree
				cameraRot.add( subSpin );
				subSpin.add( sunMesh );
				
				//moon tree
				moveEarth.add( moonOrb );
				moonOrb.add( moonTrabs );
				moonTrabs.add( moonSpin );
				moonSpin.add( moonMesh );
				

				renderer = new THREE.WebGLRenderer();
				renderer.setClearColor( 0x000000 );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				window.addEventListener( 'resize', onWindowResize, false );
			}

			
			function render() {			

				// Set up the camera
				camera.position.x = 0;
				camera.position.y = -mouseY*10;
				camera.lookAt( scene.position );

				// Perform animations
				moveEarth.position.x = 5;
				objectSpin.rotation.y += 0.05;
				cameraRot.rotation.x = 0.51;
				earthOrb.rotation.y += 0.02; 
				subSpin.rotation.y += 0.009;
				moonOrb.rotation.y += 0.07;
				moonTrabs.position.x = 2;
				moonSpin.rotation.y += 0.1; 
				

				// Render the scene
				renderer.render( scene, camera );
			}


			function animate() {
				requestAnimationFrame( animate ); // Request to be called again for next frame
				render();
			}

			
			init();    // Set up the scene
			animate(); // Enter an infinite loop
			
		</script>
	</body>
</html>
